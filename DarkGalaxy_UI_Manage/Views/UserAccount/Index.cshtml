@{
    ViewBag.Title = "普通用户";
    Layout = "~/Views/Shared/_TabLayout.cshtml";
}

<!-- 主体工具栏 -->
<div class="layui-row layui-elem-quote dgalaxy-tab-tool">
    <div class="layui-inline dgalaxy-search-box">
        <input id="Search" name="id" class="layui-input" placeholder="请输入帐号（手机/邮箱/帐号）" autocomplete="off">
    </div>
    <button id="SearchButton" class="layui-btn layui-btn-normal" data-type="Search">
        <i class="layui-icon">&#xe615;</i>&nbsp;搜索
    </button>
    <button id="Refresh" class="layui-btn layui-btn-warm">
        <i class="layui-icon">&#x1002;</i>&nbsp;刷新
    </button>
</div>

<!-- 主体表格 -->
<table id="Table" lay-filter="Table"></table>

@section Foot
{
    <!-- layui -->
<script>
        layui.use(['layer', 'table'], function () {
            var $ = layui.jquery,
                layer = layui.layer,
                table = layui.table,
                active = {
                    //数据表格重载（搜索）
                    Search: function () {
                        var search = $('#Search');
                        table.reload('DataTable', {
                            where: {
                                Search: $('#Search').val()
                            }
                        });
                    }
                };

            /*数据表格加载*/
            table.render({
                id: 'DataTable',
                elem: '#Table',
                height: 'full-120',
                cols: [[
                    { fixed: 'left', field: 'ID', title: 'ID', width: 70, align: 'center' },
                    { field: 'UserName', title: '帐号', align: 'center' },
                    { field: 'Phone', title: '手机号',align: 'center' },
                    { field: 'Email', title: '邮箱', align: 'center' },
                    { field: 'CreateDateTime', title: '创建时间', minWidth: 150, align: 'center', templet: '#CreateDateTime', sort: true },
                    { fixed: 'right', title: '操作', minWidth: 300, align: 'center', toolbar: '#Tools' }
                ]],
                url: '@Url.Action("IndexJson", "UserAccount")',
                method: 'POST',
                request: {
                    pageName: 'Page', //页码的参数名称
                    limitName: 'PageSize' //每页数据量的参数名
                },
                response: {
                    statusName: 'Code',
                    statusCode: 200, //成功的状态码
                    msgName: 'Message', //状态信息的字段名称
                    countName: 'Total', //数据总数的字段名称
                    dataName: 'Datas' //数据列表的字段名称
                },
                page: true,
                limits: [5, 10, 15, 20, 30],
                limit: 15,
                initSort: {
                    field: 'CreateDateTime', //排序字段，对应 cols 设定的各字段名
                    type: 'asc' //排序方式  asc: 升序、desc: 降序、null: 默认排序
                }
            });

            /*表格搜索*/
            $('#SearchButton').live('click', function () {
                var type = $(this).data('type');
                active[type] ? active[type].call(this) : '';
            });

            /*工具条监听*/
            table.on('tool(Table)', function (obj) {
                var data = obj.data; //获得当前行数据
                var layEvent = obj.event; //获得 lay-event 对应的值
                var tr = obj.tr; //获得当前行 tr 的DOM对象

                if (layEvent === 'detailsUserInfo') { //查看个人资料
                    layer.open({
                        id: 'DetailsUserInfo',
                        type: 2,
                        title: '个人资料',
                        content: '@Url.Action("Details", "UserInfo")' + '?UID=' + data.ID,
                        anim: 1,
                        shadeClose: true,
                        shade: 0.8,
                        resize: false,
                        area: ['90%', '90%']
                    });
                }
                else if (layEvent === 'detailsPassengerIndex') { //查看常用旅客
                    layer.open({
                        id: 'DetailsPassengerIndex',
                        type: 2,
                        title: '常用旅客',
                        content: '@Url.Action("Index", "Passenger")' + '?UID=' + data.ID,
                        anim: 1,
                        shadeClose: true,
                        shade: 0.8,
                        resize: false,
                        area: ['90%', '90%']
                    });
                }
                else if (layEvent === 'detailsContactsIndex') { //查看常用联系人
                    layer.open({
                        id: 'DetailsContactsIndex',
                        type: 2,
                        title: '常用联系人',
                        content: '@Url.Action("Index", "Contacts")' + '?UID=' + data.ID,
                        anim: 1,
                        shadeClose: true,
                        shade: 0.8,
                        resize: false,
                        area: ['90%', '90%']
                    });
                }
            });

        });
</script>
    <!-- 数据模版 -->
    <script type="text/html" id="CreateDateTime">
        {{ toDate(d.CreateDateTime).pattern("yyyy-MM-dd HH:mm") }}
    </script>
    <!-- 工具栏模版 -->
    <script type="text/html" id="Tools">
        <button class="layui-btn layui-btn-xs" lay-event="detailsUserInfo"><i class="layui-icon">&#xe63c;</i>个人资料</button>
        <button class="layui-btn layui-btn-xs" lay-event="detailsPassengerIndex"><i class="layui-icon">&#xe63c;</i>常用旅客</button>
        <button class="layui-btn layui-btn-xs" lay-event="detailsContactsIndex"><i class="layui-icon">&#xe63c;</i>常用联系人</button>
    </script>
}
